<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-10P45GZ5Y6");
    </script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>UK Computer Science Course Finder</title>
    <style>
      /* Base styles */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f4f4f4;
        line-height: 1.6;
        font-size: 16px;
      }

      header {
        background: #35424a;
        color: #ffffff;
        padding: 20px 0;
        text-align: center;
        margin-bottom: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .container {
        width: 90%;
        max-width: 1200px;
        margin: 0 auto;
        overflow: hidden;
        padding-bottom: 80px;
      }

      .controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 15px;
      }

      .search-container {
        flex: 1;
        min-width: 250px;
      }

      #search-input {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #ddd;
        border-radius: 4px;
        font-size: 16px;
      }

      #search-input:focus {
        border-color: #08d2d2;
        outline: none;
        box-shadow: 0 0 5px rgba(8, 210, 143, 0.5);
      }

      .pagination-controls {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 15px;
        margin: 25px 0;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        flex-wrap: wrap;
      }

      .pagination-controls button {
        background: #08d28f;
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
        font-size: 16px;
        transition: all 0.3s ease;
        min-width: 100px;
        flex: 1;
        max-width: 150px;
      }

      .pagination-controls button:hover:not(:disabled) {
        background: #08cdd0;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(8, 210, 143, 0.3);
      }

      .pagination-controls button:disabled {
        background: #cccccc;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
        opacity: 0.6;
      }

      .page-info {
        font-weight: bold;
        color: #35424a;
        font-size: 18px;
        min-width: 120px;
        text-align: center;
      }

      .university-list {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
        gap: 20px;
      }

      .university-card {
        background: #ffffe0;
        border: #ccc 1px solid;
        padding: 20px;
        width: 100%;
        max-width: 400px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .university-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
      }

      .university-card h3 {
        color: #2c3e50;
        margin-top: 0;
        border-bottom: 2px solid #eee;
        padding-bottom: 10px;
        font-size: 20px;
      }

      .university-card p {
        margin: 8px 0;
        font-size: 16px;
      }

      .university-card button {
        background: #08d28f;
        color: white;
        border: none;
        padding: 12px 15px;
        border-radius: 4px;
        cursor: pointer;
        width: 100%;
        font-weight: bold;
        margin-top: 10px;
        transition: background 0.3s;
        font-size: 16px;
      }

      .university-card button:hover {
        background: #08cdd0;
      }

      .university-card button.selected {
        background: #35424a;
      }

      .instructions {
        background: #e7f3fe;
        border-left: 4px solid #2196f3;
        padding: 15px;
        margin-bottom: 25px;
        border-radius: 4px;
      }

      .next-button-container {
        position: fixed;
        bottom: 20px;
        left: 20px;
        right: 20px;
        display: flex;
        justify-content: center;
        z-index: 1000;
      }

      .next-button {
        background: #35424a;
        color: white;
        border: none;
        text-align: center;
        padding: 15px 30px;
        border-radius: 50px;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
        opacity: 0.6;
        width: 100%;
        max-width: 300px;
      }

      .next-button.enabled {
        background: #08d28f;
        opacity: 1;
      }

      .next-button.enabled:hover {
        background: #08cdd0;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(8, 210, 143, 0.4);
      }

      .next-button:active {
        transform: translateY(0);
      }

      .shortlist-counter {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #08d28f;
        color: white;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        z-index: 1001;
      }

      /* === Enhanced Cookie Banner Styles - Centered Version === */
      #cookie-banner {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #ffffff;
        color: #35424a;
        padding: 25px;
        text-align: left;
        font-size: 15px;
        z-index: 2000;
        display: none;
        opacity: 0;
        transition: opacity 0.5s ease, transform 0.3s ease;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        border-radius: 12px;
        border: 1px solid #e0e0e0;
        width: 90%;
        max-width: 550px;
        max-height: 80vh;
        overflow-y: auto;
      }

      #cookie-banner.show {
        display: block;
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }

      .cookie-container {
        display: flex;
        flex-direction: column;
        gap: 18px;
      }

      .cookie-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: 10px;
        border-bottom: 2px solid #f0f0f0;
      }

      .cookie-title {
        font-size: 20px;
        font-weight: bold;
        color: #35424a;
        margin: 0;
      }

      .cookie-icon {
        font-size: 22px;
        color: #08d28f;
      }

      .cookie-content {
        display: flex;
        flex-direction: column;
        gap: 18px;
      }

      .cookie-description {
        line-height: 1.5;
        font-size: 14px;
      }

      .cookie-types {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 8px;
      }

      .cookie-type {
        background-color: #e7f3fe;
        padding: 6px 10px;
        border-radius: 16px;
        font-size: 12px;
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .cookie-type.essential {
        background-color: #e7f9f0;
      }

      .cookie-type.analytics {
        background-color: #e7f3fe;
      }

      .cookie-type.preferences {
        background-color: #fff4e5;
      }

      .cookie-type-icon {
        font-size: 12px;
      }

      .cookie-details {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #08d28f;
      }

      .cookie-details-title {
        font-weight: bold;
        margin-bottom: 8px;
        color: #35424a;
        font-size: 14px;
      }

      .cookie-details ul {
        margin: 0;
        padding-left: 15px;
        font-size: 13px;
      }

      .cookie-details li {
        margin-bottom: 5px;
        line-height: 1.4;
      }

      .cookie-controls {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        justify-content: flex-end;
        align-items: center;
        margin-top: 10px;
        padding-top: 15px;
        border-top: 1px solid #f0f0f0;
      }

      .cookie-link {
        color: #08d28f;
        text-decoration: underline;
        cursor: pointer;
        font-size: 13px;
        margin-right: auto;
      }

      .cookie-link:hover {
        color: #08cdd0;
      }

      .cookie-button {
        padding: 10px 18px;
        border: none;
        border-radius: 6px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 110px;
        font-size: 14px;
      }

      #accept-cookies {
        background-color: #08d28f;
        color: white;
      }

      #accept-cookies:hover {
        background-color: #08cdd0;
        transform: translateY(-1px);
        box-shadow: 0 3px 8px rgba(8, 210, 143, 0.3);
      }

      #configure-cookies {
        background-color: transparent;
        color: #35424a;
        border: 1px solid #ddd;
      }

      #configure-cookies:hover {
        background-color: #f5f5f5;
        border-color: #08d28f;
      }

      /* Add a semi-transparent overlay */
      #cookie-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1999;
        display: none;
        opacity: 0;
        transition: opacity 0.5s ease;
      }

      #cookie-overlay.show {
        display: block;
        opacity: 1;
      }

      /* Cookie Preferences Modal */
      #cookie-preferences {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 3000;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      #cookie-preferences.show {
        display: flex;
        opacity: 1;
      }

      .preferences-container {
        background-color: white;
        width: 90%;
        max-width: 500px;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        max-height: 80vh;
        overflow-y: auto;
      }

      .preferences-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
      }

      .preferences-title {
        font-size: 22px;
        font-weight: bold;
        color: #35424a;
        margin: 0;
      }

      .close-preferences {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #777;
      }

      .close-preferences:hover {
        color: #35424a;
      }

      .preference-section {
        margin-bottom: 20px;
        padding: 15px;
        border-radius: 8px;
        background-color: #f8f9fa;
      }

      .preference-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .preference-name {
        font-weight: bold;
        color: #35424a;
      }

      .preference-toggle {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
      }

      .preference-toggle input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .preference-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 24px;
      }

      .preference-slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }

      input:checked + .preference-slider {
        background-color: #08d28f;
      }

      input:checked + .preference-slider:before {
        transform: translateX(26px);
      }

      .preference-description {
        font-size: 13px;
        line-height: 1.5;
        color: #666;
      }

      .preferences-buttons {
        display: flex;
        justify-content: flex-end;
        gap: 15px;
        margin-top: 25px;
      }

      .preferences-button {
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 110px;
        font-size: 14px;
      }

      #save-preferences {
        background-color: #08d28f;
        color: white;
      }

      #save-preferences:hover {
        background-color: #08cdd0;
      }

      #reject-all {
        background-color: transparent;
        color: #35424a;
        border: 2px solid #ddd;
      }

      #reject-all:hover {
        background-color: #f5f5f5;
        border-color: #35424a;
      }

      /* Mobile Responsive Styles */
      @media (max-width: 768px) {
        body {
          padding: 15px;
          font-size: 14px;
        }

        .container {
          width: 95%;
          padding: 10px;
          padding-bottom: 80px;
        }

        .controls {
          flex-direction: column;
          gap: 10px;
        }

        .search-container {
          width: 100%;
        }

        .university-card {
          width: 100%;
          margin: 10px 0;
          padding: 15px;
        }

        .university-card h3 {
          font-size: 18px;
        }

        .university-card p {
          font-size: 14px;
        }

        .pagination-controls {
          gap: 10px;
          padding: 10px;
        }

        .pagination-controls button {
          padding: 10px 15px;
          font-size: 14px;
          min-width: 80px;
        }

        .page-info {
          font-size: 16px;
          min-width: 100px;
        }

        .next-button-container {
          left: 15px;
          right: 15px;
          bottom: 15px;
        }

        .next-button {
          padding: 12px 25px;
          font-size: 16px;
        }

        .shortlist-counter {
          top: 15px;
          right: 15px;
        }

        header {
          padding: 15px 0;
          margin-bottom: 15px;
        }

        header h1 {
          font-size: 24px;
        }

        header p {
          font-size: 14px;
        }
      }

      @media (max-width: 480px) {
        body {
          padding: 10px;
        }

        .container {
          width: 100%;
          padding: 5px;
          padding-bottom: 80px;
        }

        .pagination-controls {
          flex-direction: column;
          gap: 8px;
        }

        .pagination-controls button {
          max-width: 100%;
          width: 100%;
        }

        .page-info {
          order: -1;
          margin-bottom: 10px;
        }

        .university-card {
          padding: 12px;
        }

        .next-button-container {
          left: 10px;
          right: 10px;
          bottom: 10px;
        }

        .shortlist-counter {
          top: 10px;
          right: 10px;
        }
      }
    </style>
  </head>

  <body>
    <header>
      <div class="container">
        <h1>UK Computer Science Course Finder</h1>
        <p>Your one-stop platform to help with your application.</p>
      </div>
    </header>

    <div class="shortlist-counter" id="shortlist-counter">0</div>

    <div class="container">
      <div class="instructions">
        <h3>How to Use This Tool</h3>
        <p>
          Select up to 5 universities to add to your shortlist. After selection,
          you'll be able to compare requirements and see your chances of
          admission.
        </p>
      </div>

      <div class="controls">
        <div class="search-container">
          <input
            type="text"
            id="search-input"
            placeholder="Search universities..."
          />
        </div>
      </div>

      <section id="universities">
        <h2>Top UK Universities for Computer Science</h2>
        <p>Select up to 5 universities to add to your shortlist.</p>
        <div class="university-list">
          <!-- University Cards will be generated by JavaScript -->
        </div>
      </section>

      <div class="controls"></div>
      <div class="pagination-controls">
        <button id="prev-page" disabled>Previous</button>
        <span class="page-info" id="page-info">Page 1 of 10</span>
        <button id="next-page" disabled>Next</button>
      </div>
    </div>

    <div class="next-button-container">
      <button class="next-button" id="next-button">Next →</button>
    </div>

    <!-- Cookie Overlay -->
    <div id="cookie-overlay"></div>

    <!-- Enhanced Cookie Consent Banner -->
    <div id="cookie-banner">
      <div class="cookie-container">
        <div class="cookie-header">
          <h3 class="cookie-title">🍪 Cookie Preferences</h3>
          <div class="cookie-icon">📊</div>
        </div>

        <div class="cookie-content">
          <div class="cookie-description">
            <p>
              We use cookies to enhance your browsing experience, analyze site
              traffic, and personalize content. Some cookies are essential for
              the website to function properly, while others help us improve
              your experience.
            </p>

            <div class="cookie-types">
              <div class="cookie-type essential">
                <span class="cookie-type-icon">🔒</span> Essential
              </div>
              <div class="cookie-type analytics">
                <span class="cookie-type-icon">📈</span> Analytics
              </div>
              <div class="cookie-type preferences">
                <span class="cookie-type-icon">⚙️</span> Preferences
              </div>
            </div>
          </div>

          <div class="cookie-details">
            <div class="cookie-details-title">Why we use cookies:</div>
            <ul>
              <li>Essential: Site functionality and security</li>
              <li>Analytics: Understanding how you use our site</li>
              <li>Preferences: Remembering your settings and choices</li>
            </ul>
          </div>
        </div>

        <div class="cookie-controls">
          <a class="cookie-link" id="learn-more"
            >Learn more in our Privacy Policy</a
          >
          <button class="cookie-button" id="configure-cookies">
            Customize
          </button>
          <button class="cookie-button" id="accept-cookies">Accept All</button>
        </div>
      </div>
    </div>

    <!-- Cookie Preferences Modal -->
    <div id="cookie-preferences">
      <div class="preferences-container">
        <div class="preferences-header">
          <h3 class="preferences-title">Cookie Preferences</h3>
          <button class="close-preferences" id="close-preferences">×</button>
        </div>

        <p>
          Manage your cookie preferences below. You can change these settings at
          any time.
        </p>

        <div class="preference-section">
          <div class="preference-header">
            <span class="preference-name">Essential Cookies</span>
            <label class="preference-toggle">
              <input type="checkbox" checked disabled />
              <span class="preference-slider"></span>
            </label>
          </div>
          <p class="preference-description">
            These cookies are necessary for the website to function and cannot
            be switched off. They are usually only set in response to actions
            made by you such as setting your privacy preferences, logging in, or
            filling in forms.
          </p>
        </div>

        <div class="preference-section">
          <div class="preference-header">
            <span class="preference-name">Analytics Cookies</span>
            <label class="preference-toggle">
              <input type="checkbox" id="analytics-toggle" checked />
              <span class="preference-slider"></span>
            </label>
          </div>
          <p class="preference-description">
            These cookies allow us to count visits and traffic sources so we can
            measure and improve the performance of our site. They help us know
            which pages are the most and least popular and see how visitors move
            around the site.
          </p>
        </div>

        <div class="preference-section">
          <div class="preference-header">
            <span class="preference-name">Preference Cookies</span>
            <label class="preference-toggle">
              <input type="checkbox" id="preferences-toggle" checked />
              <span class="preference-slider"></span>
            </label>
          </div>
          <p class="preference-description">
            These cookies enable the website to provide enhanced functionality
            and personalization. They may be set by us or by third-party
            providers whose services we have added to our pages.
          </p>
        </div>

        <div class="preferences-buttons">
          <button class="preferences-button" id="reject-all">Reject All</button>
          <button class="preferences-button" id="save-preferences">
            Save Preferences
          </button>
        </div>
      </div>
    </div>

    <script>
      // Initialize shortlist array
      let universities = [];
      let shortlist = [];
      const MAX_SELECTION = 5;

      // DOM elements
      const universityList = document.querySelector(".university-list");
      const nextButton = document.getElementById("next-button");
      const shortlistCounter = document.getElementById("shortlist-counter");

      const ITEMS_PER_PAGE = 10;
      let currentPage = 1;
      let filteredUniversities = [];

      async function loadUniversitiesData() {
        try {
          const response = await fetch("universities.json");
          if (!response.ok) {
            throw new Error("Failed to load universities data");
          }
          universities = await response.json();
          filteredUniversities = [...universities];
          renderUniversities();
          updatePaginationButtons();
          console.log(`Loaded ${universities.length} universities from JSON`);
        } catch (error) {
          console.error("Error loading universities data:", error);
          alert(
            "Error loading university data. Please try refreshing the page."
          );
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        loadUniversitiesData();
      });

      const searchInput = document.getElementById("search-input");
      const prevPageButton = document.getElementById("prev-page");
      const nextPageButton = document.getElementById("next-page");
      const pageInfo = document.getElementById("page-info");

      searchInput.addEventListener("input", (e) => {
        const searchTerm = e.target.value.toLowerCase();

        if (searchTerm.trim() === "") {
          filteredUniversities = [...universities];
        } else {
          filteredUniversities = universities.filter((uni) =>
            uni.name.toLowerCase().includes(searchTerm)
          );
        }
        currentPage = 1;
        renderUniversities();
        updatePaginationButtons();
      });

      prevPageButton.addEventListener("click", () => {
        if (currentPage > 1) {
          currentPage--;
          renderUniversities();
          updatePaginationButtons();
        }
      });

      nextPageButton.addEventListener("click", () => {
        if (
          currentPage < Math.ceil(filteredUniversities.length / ITEMS_PER_PAGE)
        ) {
          currentPage++;
          renderUniversities();
          updatePaginationButtons();
        }
      });

      function renderUniversities() {
        universityList.innerHTML = "";

        const instructions = document.querySelector(".instructions");
        const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
        const endIndex = startIndex + ITEMS_PER_PAGE;
        const universitiesToShow = filteredUniversities.slice(
          startIndex,
          endIndex
        );

        universitiesToShow.forEach((uni, index) => {
          const card = document.createElement("div");
          card.className = "university-card";
          card.innerHTML = `
          <h3>${uni.name}</h3>
          <p><strong>A-levels:</strong> ${uni.aLevels}</p>
          <p><strong>IB:</strong> ${uni.ib}</p>
          <p><strong>Admission Test:</strong> ${uni.admissionTest}</p>
          <p><strong>Fees (Int'l):</strong> ${uni.fees}</p>
          <p><strong>Location:</strong> ${uni.location}</p>
          <p><strong>Language Requirements:</strong> ${uni.language}</p>
          <button data-name="${uni.name}">${
            shortlist.find((item) => item.name === uni.name)
              ? "Remove from Shortlist"
              : "Add to Shortlist"
          }</button>
        `;
          universityList.appendChild(card);
        });
        instructions.scrollIntoView({ behavior: "smooth" });

        // Re-attach event listeners to new buttons
        document
          .querySelectorAll(".university-card button")
          .forEach((button) => {
            button.addEventListener("click", (e) => {
              const universityName = e.target.getAttribute("data-name");
              const university = universities.find(
                (uni) => uni.name === universityName
              );

              // Check if already in shortlist
              const index = shortlist.findIndex(
                (item) => item.name === university.name
              );

              if (index === -1) {
                // Add to shortlist if not already there and we have space
                if (shortlist.length < MAX_SELECTION) {
                  shortlist.push(university);
                  e.target.textContent = "Remove from Shortlist";
                  e.target.classList.add("selected");
                } else {
                  alert(
                    `You can only select up to ${MAX_SELECTION} universities.`
                  );
                }
              } else {
                // Remove from shortlist
                shortlist.splice(index, 1);
                e.target.textContent = "Add to Shortlist";
                e.target.classList.remove("selected");
              }

              // Update UI
              updateShortlistCounter();
              updateNextButton();
            });
          });
      }

      function updatePaginationButtons() {
        const totalPages = Math.ceil(
          filteredUniversities.length / ITEMS_PER_PAGE
        );
        pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;

        prevPageButton.disabled = currentPage === 1;
        nextPageButton.disabled =
          currentPage === totalPages || totalPages === 0;
      }

      updatePaginationButtons();
      renderUniversities();

      // Update shortlist counter
      function updateShortlistCounter() {
        shortlistCounter.textContent = shortlist.length;
      }

      // Update next button state
      function updateNextButton() {
        if (shortlist.length > 0) {
          nextButton.classList.add("enabled");
        } else {
          nextButton.classList.remove("enabled");
        }
      }

      // Next button functionality
      nextButton.addEventListener("click", () => {
        if (shortlist.length > 0) {
          // Store shortlist in localStorage for the next page
          localStorage.setItem(
            "universityShortlist",
            JSON.stringify(shortlist)
          );
          // Redirect to the next page
          window.location.href = "home-page.html";
        } else {
          // No universities selected
          alert("Please select at least one university to continue.");
        }
      });

      // Initialize UI
      updateShortlistCounter();
      updateNextButton();

      // === Enhanced Cookie Consent Script ===
      function setCookie(name, value, days) {
        const expires = new Date(Date.now() + days * 864e5).toUTCString();
        document.cookie = `${name}=${encodeURIComponent(
          value
        )}; expires=${expires}; path=/`;
      }

      function getCookie(name) {
        return document.cookie.split("; ").reduce((r, v) => {
          const parts = v.split("=");
          return parts[0] === name ? decodeURIComponent(parts[1]) : r;
        }, "");
      }

      function setCookiePreferences(analytics, preferences) {
        setCookie("cookiesAnalytics", analytics ? "true" : "false", 365);
        setCookie("cookiesPreferences", preferences ? "true" : "false", 365);
        setCookie("cookiesConfigured", "true", 365);

        // Update Google Analytics based on user choice
        if (typeof gtag !== "undefined") {
          gtag("consent", "update", {
            analytics_storage: analytics ? "granted" : "denied",
          });
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        // Set default consent state based on user preference
        const analyticsAccepted = getCookie("cookiesAnalytics") === "true";
        if (typeof gtag !== "undefined") {
          gtag("consent", "default", {
            analytics_storage: analyticsAccepted ? "granted" : "denied",
          });
        }
      });

      window.addEventListener("load", () => {
        const banner = document.getElementById("cookie-banner");
        const overlay = document.getElementById("cookie-overlay");
        const acceptBtn = document.getElementById("accept-cookies");
        const configureBtn = document.getElementById("configure-cookies");
        const learnMoreLink = document.getElementById("learn-more");
        const preferencesModal = document.getElementById("cookie-preferences");
        const closePreferences = document.getElementById("close-preferences");
        const savePreferences = document.getElementById("save-preferences");
        const rejectAll = document.getElementById("reject-all");
        const analyticsToggle = document.getElementById("analytics-toggle");
        const preferencesToggle = document.getElementById("preferences-toggle");

        // Check if user has already made a choice
        if (!getCookie("cookiesConfigured")) {
          banner.classList.add("show");
          overlay.classList.add("show");
        }

        // Accept all cookies
        acceptBtn.addEventListener("click", () => {
          setCookiePreferences(true, true);
          banner.classList.remove("show");
          overlay.classList.remove("show");
          setTimeout(() => {
            banner.style.display = "none";
            overlay.style.display = "none";
          }, 500);
        });

        // Open preferences modal
        configureBtn.addEventListener("click", () => {
          preferencesModal.classList.add("show");
        });

        // Close preferences modal
        closePreferences.addEventListener("click", () => {
          preferencesModal.classList.remove("show");
        });

        // Save preferences
        savePreferences.addEventListener("click", () => {
          setCookiePreferences(
            analyticsToggle.checked,
            preferencesToggle.checked
          );
          preferencesModal.classList.remove("show");
          banner.classList.remove("show");
          overlay.classList.remove("show");
          setTimeout(() => {
            banner.style.display = "none";
            overlay.style.display = "none";
          }, 500);
        });

        // Reject all non-essential cookies
        rejectAll.addEventListener("click", () => {
          setCookiePreferences(false, false);
          preferencesModal.classList.remove("show");
          banner.classList.remove("show");
          overlay.classList.remove("show");
          setTimeout(() => {
            banner.style.display = "none";
            overlay.style.display = "none";
          }, 500);
        });

        // Learn more link (placeholder)
        learnMoreLink.addEventListener("click", () => {
          alert(
            "This would typically link to your detailed privacy policy page."
          );
        });
      });

      // Temporary function for testing - remove in production
      function resetCookies() {
        document.cookie =
          "cookiesConfigured=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        document.cookie =
          "cookiesAnalytics=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        document.cookie =
          "cookiesPreferences=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        location.reload();
      }
    </script>
  </body>
</html>
